import logging
import random
import asyncio

from telegram import Update
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    filters,
)

# ================= Bot configuration ===================
BOT_TOKEN = "8102914320:AAGhC_xrDzZfVzRDyN8xErwtFdlVeuGkopI"

# ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§ØªØª Ø±Ùˆ Ø¯Ù‚ÛŒÙ‚ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡ (Ø¨Ø§ @)
BOT_USERNAME = "@chopan_bot"

BOT_NAME = "Ú†ÙˆÙ¾Ø§Ù†"
BOT_TRIGGERS = ["Ú†ÙˆÙ¾Ø§Ù†", "chopan", "shepherd"]

# ============ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± =============
AUTO_MESSAGES = [
    "ðŸ’€ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§ÙˆÙ…Ø¯Ù… Ø³Ø±Ú© Ø¨Ú©Ø´Ù… Ø¨Ø¨ÛŒÙ†Ù… Ø§ÙˆØ¶Ø§Ø¹ Ú†Ø·ÙˆØ±Ù‡â€¦",
    "ðŸ˜‚ Ø¯Ø§Ø±Ù… Ø¨Ø§ Ø®ÙˆØ¯Ù… Ø­Ø±Ù Ù…ÛŒâ€ŒØ²Ù†Ù…ØŒ ÙˆÙ„ÛŒ Ø®Ø¨ Ø¨Ø¯ Ù†ÛŒØ³Øª Ø¯ÙˆØ³ØªØ§Ù† Ù‡Ù… Ø¨Ø´Ù†ÙˆÙ†!",
    "ðŸ’¡ Ø§Ù…Ø±ÙˆØ² ÛŒÙ‡ Ø§ÛŒØ¯Ù‡â€ŒÛŒ Ø¹Ø§Ù„ÛŒ ÙˆØ§Ø³Ù‡ Ù…ÛŒÙ… Ø¬Ø¯ÛŒØ¯ Ø¯Ø§Ø±Ù….",
    "ðŸŽ‰ Ø¬Ø´Ù† Ù…ÛŒÙ… Ø¯Ø§Ø±ÛŒÙ…! ÛŒÚ©ÛŒ GIF Ø¨ÙØ±Ø³ØªÙ‡.",
    "ðŸ”¥ Ú¯ÙˆØ³ÙÙ†Ø¯Ø§Øª Ø±Ùˆ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ØŒ Ø¯Ø§Ø±Ù… Ù…ÛŒâ€ŒÛŒØ§Ù…!",
    "ðŸ¤– ÙÙ‚Ø· Ù…Ù†Ù… ÛŒØ§ Ù‡Ù…Ù‡ Ø¯Ø§Ø±Ù† Ø³Ø± Ú©Ø¯ÙˆÙ… Ù‚Ø³Ù…Øª Stranger Things Ø¨Ø­Ø« Ù…ÛŒâ€ŒÚ©Ù†Ù†ØŸ",
    "ðŸ“ˆ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† Ø¨Ø§Ù„Ø§ Ø±ÙØªÙ‡ØŒ Ú¯ÙˆØ³ÙÙ†Ø¯Ø§ Ù‡ÛŒÚ†ÛŒ Ù†Ù…ÛŒâ€ŒÙÙ‡Ù…Ù†.",
    "ðŸŽ¶ ÛŒÙ‡ ØªØ±Ú© Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ±ÛŒÙ…Ø±Ù‡Ø§ Ø¯Ø§Ø±ÛŒÙ….",
    "âš ï¸ Ù‡Ø´Ø¯Ø§Ø±! Ø§ÛŒÙ† Ø¨Ø§Øª Ù…Ù…Ú©Ù†Ù‡ ÙˆØ³Ø· Ø¨Ø­Ø« Ø®Ø§Ù…ÙˆØ´ Ø¨Ø´Ù‡.",
    "ðŸ’¬ Ø§ÛŒÙ†â€ŒØ¨Ø§Ø± Ù…Ù† Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù…: Ø³Ù„Ø§Ù…â€¦ ØµØ¯Ø§ Ø¯Ø§Ø±Ù…ØŸ",
    "ðŸ’¤ ÙÚ©Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø®ÙˆØ§Ø¨Ù… Ø¨ÛŒØ§Ø¯ØŒ Ø§ÛŒÙ†Ù‚Ø¯Ø± Ù…ÛŒÙ… Ø¯ÛŒØ¯Ù‡â€ŒÙ….",
    "ðŸš€ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ù…ÙˆØ´Ú© Ù…ÛŒÙ… Ù¾Ø±ØªØ§Ø¨ Ú©Ù†ÛŒÙ…ØŸ",
    "ðŸŒŒ Ø§Ù…Ø´Ø¨ Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù…ØŒ ÙˆÙ„ÛŒ ØªÙˆ Ú¯Ø±ÙˆÙ‡ Ø´Ù…Ø§ Ø¬Ø°Ø§Ø¨â€ŒØªØ±Ù†!",
    "ðŸ“¢ Ø§Ø¹Ù„Ø§Ù…ÛŒÙ‡: Ú†ÙˆÙ¾Ø§Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ Ú†Ø§ÛŒ Ø¨Ø®ÙˆØ±Ù‡ØŒ Ú©ÛŒ Ø´ÛŒØ±ÛŒÙ†Ø´ Ú©Ù†Ù‡ØŸ",
    "ðŸ’° Ø§Ù…Ø±ÙˆØ² ØªÙˆ Ø®ÙˆØ§Ø¨ Ø¯Ø§Ø±Ù… Ù¾ÙˆÙ„ Ú†Ø§Ù¾ Ù…ÛŒâ€ŒÚ©Ù†Ù…!",
    "ðŸ•µï¸â€â™‚ï¸ Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡ Ù…ÛŒÙ…â€ŒÙ‡Ø§ Ø¨Ø±Ú¯Ø´ØªÙ‡ Ø¨Ù‡ Ú¯Ø±ÙˆÙ¾.",
    "ðŸŽ² Ø¨Ø®Øªâ€ŒØ¢Ø²Ù…Ø§ÛŒÛŒ Ù…ÛŒÙ…: Ø­Ø¯Ø³ Ø¨Ø²Ù† ÙØ±Ø¯Ø§ Ú†ÛŒ Ù…ÛŒâ€ŒÚ¯Ù…ØŸ",
    "ðŸ–¼ï¸ Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„Ù…Ùˆ Ø¹ÙˆØ¶ Ú©Ø±Ø¯Ù…ØŒ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒØŸ",
    "ðŸ¦„ Ù…Ù†Ù… Ú¯Ø§Ù‡ÛŒ Ø§Ø­Ø³Ø§Ø³ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø§Ø³Ø¨ ØªÚ©â€ŒØ´Ø§Ø®Ù…!",
    "ðŸ”” Ø²Ù†Ú¯ Ø®Ø·Ø±: Ø¨Ø¯ÙˆÙ† Ù…ÛŒÙ… Ù†Ù¾Ø±Ø³!",
]

# ============ ÙˆØ§Ú©Ù†Ø´ Ø¨Ù‡ Ø±ÛŒÙ¾Ù„Ø§ÛŒâ€ŒÙ‡Ø§ =============
REPLY_RESPONSES = [
    "ðŸ˜‚ðŸ˜‚ðŸ˜‚",
    "ðŸ’€ Ø§Ø³Ú©Ù„Øª Ø®ÙˆØ¯Ù…Ù… Ø®Ù†Ø¯ÛŒØ¯!",
    "ðŸ’€ Ø¯ÛŒÚ¯Ù‡ ØªÙ…ÙˆÙ…Ù‡! Ø§ÛŒÙ†Ùˆ Ø¨Ø§ÛŒØ¯ ÙØ±ÛŒÙ… Ú©Ù†Ù…!",
    "ðŸ˜‚ Ø§ÛŒÙˆÙ„ØŒ ØªØ±Ú©ÙˆÙ†Ø¯ÛŒ!",
    "ðŸ’€ Ù…ØºØ²Ù… Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª Ø´Ø¯ Ø¨Ø§ Ø§ÛŒÙ† Ø­Ø±ÙØª!",
    "ðŸ˜‚ ÙÙ‚Ø· ÛŒÙ‡ Ú¯ÙˆØ³ÙÙ†Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ Ø§ÛŒÙ†Ø¬ÙˆØ±ÛŒ Ø¬ÙˆØ§Ø¨ Ù…ÛŒâ€ŒØ¯Ù‡!",
    "ðŸ’€ðŸ˜‚ Ø§ÛŒÙ†Ùˆ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø¯Ú©Ø³Øª Ø¨Ø§ÛŒØ¯ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒÙ…!",
    "ðŸ˜‚ðŸ˜‚ Ø§ÛŒÙ†Ùˆ Ø¨Ø°Ø§Ø± ØªÙˆ Ø±Ø²ÙˆÙ…Ù‡â€ŒØ§Øª Ø¨Ù†ÙˆÛŒØ³!",
    "ðŸ’€ Ø¯Ø§Ø¯Ø§Ø´ Ù…ØºØ²Ù… Ù‡Ù†Ú¯ Ú©Ø±Ø¯!",
    "ðŸ˜‚ Ø§Ø³ØªØ§Ø¯ Ø·Ù†Ø² Ø®ÙˆØ¯ØªÛŒ!",
    "ðŸ’€ Ø®Ø¨ Ø¯ÛŒÚ¯Ù‡ØŒ ØªØ±Ú©ÙˆÙ†Ø¯ÛŒ Ù…Ø§Ø±Ùˆ!",
    "ðŸ˜‚ðŸ˜‚ Ø§ÛŒÙ† ÛŒÙ‡ Ø³Ø·Ø­ Ø¨Ø§Ù„Ø§ØªØ±Ù‡!",
    "ðŸ’€ Ø§ÛŒÙ† Ø­Ø±ÙØª Ø±Ùˆ Ú¯ÙˆÚ¯Ù„ Ø³Ø±Ú† Ú©Ø±Ø¯Ù…ØŒ Ø¬ÙˆØ§Ø¨ Ù†Ø¯Ø§Ø¯!",
    "ðŸ˜‚ Ø®Ø¯Ø§ÙˆÚ©ÛŒÙ„ÛŒ Ø²Ø¯ÛŒ ÙˆØ³Ø· Ù‡Ø¯Ù!",
    "ðŸ’€ Ú©Ù¾Ø´Ù† Ú¯Ø°Ø§Ø´ØªÙ… Ø²ÛŒØ± Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ù„Ø§Ù†!",
    "ðŸ˜‚ Ø§ÛŒÙ†Ù‚Ø¯ Ø®ÙˆØ¨ Ø¨ÙˆØ¯ØŒ Û³ Ø¨Ø§Ø± Ø®ÙˆÙ†Ø¯Ù…Ø´!",
    "ðŸ’€ Ø±ÙˆØ§Ù†ÛŒ Ø´Ø¯ÛŒÙ… Ù‡Ù…Ú¯ÛŒ!",
    "ðŸ˜‚ðŸ˜‚ Ø¨ÛŒØ§ Ø¯Ø³ØªØªÙˆ Ø¨Ø²Ù† Ø¨Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙ†ØŒ Ø§Ø³ØªÙ†Ø¯Ø¢Ù¾ Ø¨ÙˆØ¯!",
    "ðŸ’€ Ø®Ù†Ø¯Ù‡â€ŒØ§Ù… Ù¾Ø±ÛŒØ¯ØŒ Ø¨Ø¹Ø¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø±Ú¯Ø´Øª!",
    "ðŸ˜‚ Ø§ÛŒÙ†Ùˆ Ø¨Ø§ÛŒØ¯ Ø¨Ø°Ø§Ø±ÛŒÙ… ØªÙˆ Ú©ØªØ§Ø¨ Ø¯Ø±Ø³ÛŒ!",
    "ðŸ’€ Ø§ÛŒÙ† Ø­Ø±ÙØª ØªÙˆÛŒ Ø²Ù†Ø¯Ú¯ÛŒÙ†Ø§Ù…Ù‡ Ù…Ù† Ø§ÙˆÙ…Ø¯!",
    "ðŸ˜‚ Ø­ØªÛŒ Ú¯ÙˆØ³ÙÙ†Ø¯Ø§Ù…Ù… Ø®Ù†Ø¯ÛŒØ¯Ù†!",
    "ðŸ’€ Ú†Ø±Ø§ Ø§ÛŒÙ†Ù‚Ø¯Ø± Ø¨Ø§Ø­Ø§Ù„ÛŒ Ø¢Ø®Ù‡ØŸ",
    "ðŸ˜‚ ØªÙˆØ±Ùˆ Ø®Ø¯Ø§ Ø¯ÛŒÚ¯Ù‡ Ù†Ú¯ÙˆØŒ Ù†ÙØ³Ù… Ú¯Ø±ÙØª!",
    "ðŸ’€ðŸ¤£ Ø§ÛŒÙ†Ùˆ Ú©Ù¾ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù… ØªÙˆ Ø¨ÛŒÙˆÛŒ Ø§ÛŒÙ†Ø³ØªØ§!",
    "ðŸ˜‚ Ø®ÙˆØ¯Ù…Ù… Ù†ÙÙ‡Ù…ÛŒØ¯Ù… Ú†ÛŒ Ø´Ø¯ ÙˆÙ„ÛŒ Ø®Ù†Ø¯ÛŒØ¯Ù…!",
    "ðŸ’€ Ø¨Ø±Ùˆ Ø§Ø³ØªØ§Ø¯! ÙÙ‚Ø· Ø¨Ø±Ùˆ!",
    "ðŸ˜‚ Ø§Ú¯Ù‡ Ù†Ø®Ù†Ø¯Ù… ÙˆØ¬Ø¯Ø§Ù† Ø¯Ø±Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…!",
    "ðŸ’€ ØªÙˆ Ø§Ø² Ø¯Ù†ÛŒØ§ÛŒ Ù…ÛŒÙ…â€ŒÙ‡Ø§ ÙØ±Ø³ØªØ§Ø¯Ù‡ Ø´Ø¯ÛŒ!",
    "ðŸ˜‚ Ù¾Ø®Ø´ Ø²Ù†Ø¯Ù‡ Ù†Ø§Ø¨ÙˆØ¯ÛŒ Ù…Ù†!",
    "ðŸ’€ Ù‚Ø±Øµ Ø®Ù†Ø¯Ù‡â€ŒÙ…Ùˆ Ù†Ø®ÙˆØ±Ø¯Ù…ØŒ ØªÙˆ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´Ø¯ÛŒ!",
    "ðŸ˜‚ Ø±ÙˆØ­Ù… ØªØ±Ú©ÛŒØ¯ Ø¨Ø§ Ø§ÛŒÙ† Ø¬Ù…Ù„Ù‡!",
    "ðŸ’€ Ù…Ù† Ø¯ÛŒÚ¯Ù‡ Ø­Ø±ÙÛŒ Ù†Ø¯Ø§Ø±Ù…ØŒ ØªÙˆ Ø¨Ø±Ø¯ÛŒ!",
    "ðŸ˜‚ Ù‡ÛŒÚ†ÛŒ ÙÙ‚Ø· Ø¨ØºØ¶ Ø®Ù†Ø¯Ù‡!",
    "ðŸ’€ Ø´ÙˆØ®ÛŒ Ø´ÙˆØ®ÛŒ Ø³Ú©ØªÙ‡ Ú©Ø±Ø¯ÛŒÙ…!",
    "ðŸ˜‚ ÛŒÙ‡ Ø¯ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø¨Ù‡ Ø®Ø¯Ø§!",
    "ðŸ’€ Ø­ØªÛŒ AI Ù‡Ù… Ù†Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø§ÛŒÙ†Ùˆ Ø¨Ø³Ø§Ø²Ù‡!",
    "ðŸ˜‚ Ø§ÛŒÙ† Ú©Ø§Ù…Ù†ØªØŒ Ø·Ù„Ø§Ø³Øª!",
    "ðŸ’€ ØªÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ú©Ø¬Ø§Ø³ØªØŸ Ù…Ù† Ø­Ø§Ø¶Ø±Ù… Ø¨Ø±Ù…!",
    "ðŸ˜‚ ØªÙˆ Ø¨ÛŒØ§ Ø¨Ú¯Ùˆ Ú©ÛŒ Ø¨Ù‡Øª Ù†ÙˆØ´ØªÙ† ÛŒØ§Ø¯ Ø¯Ø§Ø¯ØŸ",
    "ðŸ’€ðŸ˜‚ Ø§ÛŒÙ†Ùˆ Ø¨ÙØ±Ø³ØªÛŒÙ… ÙˆØ§Ø³Ù‡ Ù†Ø§Ø³Ø§ Ø´Ø§ÛŒØ¯ Ø¨ÙÙ‡Ù…Ù† Ú†ÛŒ Ú¯ÙØªÛŒ!",
    "ðŸ˜‚ Ø§Ù„Ø§Ù† Ø¬Ø¯ÛŒ Ø¨ÙˆØ¯ ÛŒØ§ Ù…Ù† Ø¯Ø§Ø±Ù… Ø²ÛŒØ§Ø¯ Ù…ÛŒâ€ŒØ®Ù†Ø¯Ù…ØŸ",
    "ðŸ’€ Ø¬Ù…Ù„Ù‡â€ŒØª Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…Ù… Ø¢Ø³ÛŒØ¨ Ø²Ø¯!",
    "ðŸ˜‚ ØªØ§ Ø­Ø§Ù„Ø§ Ø§ÛŒÙ†Ù‚Ø¯Ø± Ø§Ø² ÛŒÙ‡ Ø¬Ù…Ù„Ù‡ Ø®ÙˆØ´Ù… Ù†ÛŒÙˆÙ…Ø¯Ù‡ Ø¨ÙˆØ¯!",
    "ðŸ’€ Ù…Ù† Ø¯ÛŒÚ¯Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆÙ†Ù…... Ø®Ù†Ø¯Ù… Ø¨Ù†Ø¯ Ù†Ù…ÛŒØ§Ø¯!",
    "ðŸ˜‚ ðŸ˜‚ ðŸ˜‚ ðŸ˜‚ Ø§ÛŒÙ†Ùˆ ØªÙˆ ØªÚ¯ Ú©Ù† ØªÙˆ ÙˆÛŒÚ©ÛŒÙ¾Ø¯ÛŒØ§!",
    "ðŸ’€ Ù¾Ø§Ø´Ùˆ Ø¨Ø±Ùˆ Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ Ø´Ùˆ Ø¨Ø§ Ø§ÛŒÙ† Ø¯ÛŒØ§Ù„ÙˆÚ¯Ø§!",
    "ðŸ˜‚ Ø§ÛŒÙ† Ø³Ø·Ø­ Ø§Ø² Ø·Ù†Ø² Ú©Ø¬Ø§Ø³Øª Ú©Ù‡ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒÙ…ØŸ",
    "ðŸ’€ ÙÙ‚Ø· ÙˆØ§ÛŒØ³Ø§ Ø¯Ø§Ø±Ù… Ø¶Ø¨Ø· Ù…ÛŒâ€ŒÚ©Ù†Ù…!",
    "ðŸ˜‚ Ø¢ÙØ±ÛŒÙ†! ÛŒÙ‡ ØªØ±ÙˆÙ„ ÙˆØ§Ù‚Ø¹ÛŒ!",
    "ðŸ’€ Ø­ØªÛŒ Ø±ÙˆØ¨Ø§Ù‡ ØªÙˆ Ø¯Ø§Ø³ØªØ§Ù†Ù… Ø®Ù†Ø¯ÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ† Ø­Ø±Ù!",
    "ðŸ˜‚ Ø®Ù†Ø¯Ù‡â€ŒØ¯Ø§Ø±ØªØ±ÛŒÙ† ØªØ±Ø§Ú˜Ø¯ÛŒâ€ŒØ§ÛŒ Ø¨ÙˆØ¯ Ú©Ù‡ Ø´Ù†ÛŒØ¯Ù…!",
]

# ============ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ ============
KEYWORD_RESPONSES = {
    "Ù…Ø§Ù…Ø§Ù†": ["Ø§Ø±Ù‡ Ù…Ø§Ù…Ø§Ù† Ø¯Ø§Ø±Ù….", "Ù…Ø§Ù…Ø§Ù†Ù… Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø´ØªÙ…Ù‡!", "Ù…Ø§Ù…Ø§Ù† Ù…Ø¹Ù†ÛŒ Ù…Ù‡Ø±Ø¨ÙˆÙ†ÛŒ ÙØ§Ø±Øº Ø§Ø² Ù‡Ø± Ú†ÛŒØ²ÛŒÙ‡."],
    "Ù¾Ø¯Ø±": ["Ù¾Ø¯Ø± Ù…Ù†Ù… Ù…Ø«Ù„ Ú©ÙˆÙ‡ Ù¾Ø´ØªÙ…Ù‡.", "Ù¾Ø¯Ø± Ú†Ø´Ù…Ù‡ Ø§Ù†Ø±Ú˜ÛŒÙ‡.", "Ù¾Ø¯Ø± ØªÙˆ Ø²Ù†Ø¯Ú¯ÛŒ Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…Ù‡."],
    "Ø¹Ø´Ù‚": ["Ø¹Ø´Ù‚ Ù…ÙˆØªÙˆØ±Ù‡ Ù‡Ù…Ù‡â€ŒÛŒ Ú©Ø§Ø¦Ù†Ø§ØªÙ‡.", "Ø¹Ø´Ù‚ Ø¨Ø§Ø´Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ Ø±Ùˆ Ø¯ÙˆØ³ Ø¯Ø§Ø±ÛŒÙ….", "Ø¨Ø¯ÙˆÙ† Ø¹Ø´Ù‚ Ù‡Ù…Ù‡ Ú†ÛŒ Ø¨ÛŒâ€ŒÙ…Ø¹Ù†ÛŒÙ‡."],
    "Ø¯ÙˆØ³Øª": ["Ø¯ÙˆØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ Ú©Ù…ÛŒØ§Ø¨Ù‡.", "Ø¯ÙˆØ³Øª ÛŒØ¹Ù†ÛŒ Ú©Ø³ÛŒ Ú©Ù‡ ÙˆØ³Ø· Ø·ÙˆÙØ§Ù† Ø¨Ø§Ø´Ù‡.", "Ø¯ÙˆØ³Øª Ø®ÙˆØ¨ Ù…Ø«Ù„ Ú¯ÙˆÙ‡Ø±Ù‡."],
    "Ø®ÙˆØ§Ø¨": ["Ø®ÙˆØ§Ø¨ Ø³Ù„Ø·Ø§Ù† Ø³Ù„Ø§Ù…ØªÛŒÙ‡.", "Ø®ÙˆØ§Ø¨ Ù†ÛŒØ§Ø²Ù‡ Ù…Ø« Ø¢Ø¨ Ùˆ ØºØ°Ø§.", "Ø®ÙˆØ§Ø¨ Ú©Ù… ÛŒØ¹Ù†ÛŒ Ø®Ø±Ø§Ø¨ÛŒ Ø³ÛŒØ³ØªÙ…."],
    "Ú©Ø§Ø±": ["Ú©Ø§Ø± Ú©Ù†ØŒ Ù¾ÙˆÙ„ Ø¯Ø± Ø¨ÛŒØ§Ø±.", "Ú©Ø§Ø± Ú©Ø±Ø¯Ù† Ú¯Ø§Ù‡ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„Ù‡.", "Ú©Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø¹Ø´Ù‚ Ø¨ÛŒâ€ŒÙ…Ø¹Ù†ÛŒÙ‡."],
    "Ø¨Ø§Ø²ÛŒ": ["Ø¨Ø§Ø²ÛŒ Ù‡Ù…ÙˆÙ† Ø¢Ø±Ø§Ù…Ø´Ù‡.", "Ø¨Ø§Ø²ÛŒ Ø¨Ø¯ÙˆÙ† Ø³Ø±Ú¯Ø±Ù…ÛŒ Ø³Ø®ØªÙ‡.", "Ø¨Ø§Ø²ÛŒ Ø±ÙˆØ­ÛŒÙ‡ Ø±Ùˆ Ù‚ÙˆÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù‡."],
    "Ú©ØªØ§Ø¨": ["Ú©ØªØ§Ø¨ Ø¨Ù‡ØªØ±ÛŒÙ† Ø¯ÙˆØ³ØªÙ‡.", "Ú©ØªØ§Ø¨ Ø®ÙˆÙ†Ù‡ Ø¢Ø¯Ù…Ù‡.", "Ú©ØªØ§Ø¨ Ø®ÙˆÙ†Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØŒ Ø¢Ø¯Ù… Ø¯ÛŒÚ¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´Ù‡."],
    "Ù‚Ù‡ÙˆÙ‡": ["Ù‚Ù‡ÙˆÙ‡ ØµØ¨Ø­ Ø¬Ø§Ù† Ù…ÛŒØ¯Ù‡.", "Ø¨ÛŒâ€ŒÙ‚Ù‡ÙˆÙ‡ Ù…Ø«Ù„ Ø§Ø¨Ø± Ø¨ÛŒ Ø¨Ø§Ø±ÙˆÙ†Ù‡.", "Ù‚Ù‡ÙˆÙ‡ Ø¨ÛŒâ€ŒØ´Ú© Ø­ÛŒØ±Ø§Ù†Ù‡."],
    "Ú†Ø§ÛŒ": ["Ú†Ø§ÛŒ Ù…Ø«Ù„ Ø¢ØºÙˆØ´Ù‡.", "Ú†Ø§ÛŒ Ø¨Ù‡ÙˆÙ†Ù‡ Ø¯ÙˆØ±Ù‡Ù…ÛŒÙ‡.", "Ú†Ø§ÛŒ Ø­Ø§Ù„Ø§ Ø­Ø§Ù„Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø±Ù‡."],
    # â€¦ ØªØ§ ÛµÛ° Ú©Ù„Ù…Ù‡ Ùˆ Û±ÛµÛ° Ø¬ÙˆØ§Ø¨
}

# Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ú†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ùˆ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
active_chats: dict[int, bool] = {}
chat_messages: dict[int, list] = {}

# =============== Logging setup ===================
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)

# =============== Bot Handlers ===================
async def send_random_message(context: ContextTypes.DEFAULT_TYPE, chat_id: int, reply_to_message_id=None) -> None:
    msg = random.choice(AUTO_MESSAGES)
    await context.bot.send_message(
        chat_id=chat_id,
        text=msg,
        reply_to_message_id=reply_to_message_id
    )

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id
    active_chats[chat_id] = True
    chat_messages.setdefault(chat_id, [])
    await update.message.reply_text("Ú†ÙˆÙ¾Ø§Ù† Ø§ÙˆÙ…Ø¯. Ú©Ø§Ø±Øª Ú†ÛŒÙ‡ØŸ")

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await update.message.reply_text("Ù…Ù† Ú†ÙˆÙ¾Ø§Ù†Ù…! Ù…Ù†Ø´Ù†ØŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ ÛŒØ§ ÙÙ‚Ø· Ø²Ù†Ú¯ Ø¨Ø²Ù†Ø› ÛŒÙ‡ Ù…ÛŒÙ… ÙˆØ§Ø³Øª Ø¯Ø§Ø±Ù….")

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id
    message = update.message
    text = (message.text or "").lower()
    entities = message.entities or []

    # Ø«Ø¨Øª ÙØ¹Ø§Ù„ÛŒØª
    if chat_id not in active_chats:
        active_chats[chat_id] = True
    chat_messages.setdefault(chat_id, []).append(message)
    if len(chat_messages[chat_id]) > 50:
        chat_messages[chat_id] = chat_messages[chat_id][-50:]

    # Û±) Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ø¨Ø§Øª
    if message.reply_to_message and message.reply_to_message.from_user.is_bot:
        await message.reply_text(random.choice(REPLY_RESPONSES))
        return

    # Û²) ÙˆØ§Ú©Ù†Ø´ Ø¨Ù‡ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ
    for kw, replies in KEYWORD_RESPONSES.items():
        if kw in text:
            await message.reply_text(random.choice(replies))
            return

    # Û³) ØªØ´Ø®ÛŒØµ Ù…Ù†Ø´Ù† Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ø¨Ø§Øª
    is_bot_mentioned = any(
        e.type == "mention" and message.text[e.offset:e.offset + e.length].lower() == @choponvip_bot.lower()
        for e in entities
    )

    # Û´) ÛŒØ§ Ø§Ø³Ù… Ø¨Ø§Øª ØªÙˆ Ù…ØªÙ† Ø§ÙˆÙ…Ø¯Ù‡
    if is_bot_mentioned or any(trigger in text for trigger in BOT_TRIGGERS):
        # ØªØ´Ø®ÛŒØµ Ø³Ù„Ø§Ù…/Ø³ÙˆØ§Ù„/Ø¹Ù…ÙˆÙ…ÛŒ
        if any(g in text for g in ["Ø³Ù„Ø§Ù…", "hi", "hello", "Ø¯Ø±ÙˆØ¯"]):
            pool = MENTION_RESPONSES["greeting"]
        elif any(q in text for q in ["?", "ØŸ", "Ú†Ø±Ø§", "Ú†Ø·ÙˆØ±", "Ú©ÛŒ", "Ú©Ø¬Ø§", "Ú†Ù‡", "Ø¢ÛŒØ§"]):
            pool = MENTION_RESPONSES["question"]
        else:
            pool = MENTION_RESPONSES["general"]
        await message.reply_text(random.choice(pool))

async def periodic_messages(context: ContextTypes.DEFAULT_TYPE) -> None:
    for chat_id in list(active_chats.keys()):
        try:
            reply_to = None
            if chat_messages.get(chat_id) and random.random() < 0.5:
                msg = random.choice(chat_messages[chat_id])
                reply_to = msg.message_id
            await send_random_message(context, chat_id, reply_to_message_id=reply_to)
        except Exception as e:
            logger.error(f"Error in periodic_messages for {chat_id}: {e}")
            active_chats.pop(chat_id, None)

async def schedule_random_periodic_messages(app: Application) -> None:
    while True:
        # Ù‡Ø± Ûµ ØªØ§ Û¶Û° Ø¯Ù‚ÛŒÙ‚Ù‡ ÛŒÙ‡ Ø¨Ø§Ø±
        interval = random.randint(300, 3600)
        await asyncio.sleep(interval)
        await periodic_messages(app)

def main() -> None:
    app = Application.builder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", help_command))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    # Ø´Ø±ÙˆØ¹ ØªØ³Ú© Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ
    asyncio.get_event_loop().create_task(schedule_random_periodic_messages(app))

    logger.info("Ú†ÙˆÙ¾Ø§Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øªâ€¦")
    app.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == "__main__":
    main()
